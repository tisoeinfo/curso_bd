-- SE UTILIZA COMO EJEMPLO EL REQUEMIENTO FUNCIONAL DE BUSQUEDA DE PRODUCTOS EN LA TIENDA SAGA FALABELLA
-- PARA ELLO, SE EXPLICA EL OPERADOR LIKE COMO BASE PARA ENTENDER EL PORQUE DE SU USO EN LA CLAUSULA WHERE
SELECT 
R.ID_RESERVA,
R.FECHA,
C.NOMBRE AS 'NOMBRE_CLIENTE',
CONCAT(M.NOMBRE, ' ',M.APE_PATERNO, ' ', M.APE_MATERNO) AS 'NOMBRE_MESERO'
FROM RESERVAS R
INNER JOIN CLIENTES C ON C.ID_CLIENTE=R.ID_CLIENTE
INNER JOIN MESEROS M ON M.ID_MESERO=R.ID_MESERO
WHERE C.NOMBRE LIKE '%AS%'

-- APLICAR UN INDICE A LA COLUMNA NOMBRE DE LA TABLA CLIENTES PARA MEJORAR EL RENDIMIENTO DE LA CONSULTA ANTERIOR!
-- ===============================================================================================================
-- #ANALIZAMOS:
-- ¿REQUIERE EL USO DE UN INDICE EL CAMPO NOMBRE DE LA TABLA CLIENTES?
-- NO, PORQUE SOLO TIENE 10 REGISTROS.

-- ¿Y SI LA TABLA CLIENTES TUVIERA 1 MILLON DE REGISTROS?
-- SI, EN ESTE CASO SI APLICA.
-- ===============================================================================================================
-- PARA ELLOS ES NECESARIO CREAR UNA CIERTA CANTIDAD DE REGISTROS EN LA TABLA CLIENTES PARA SIMULAR ESE ESCENARIO. 
-- PROCESO DE APRENDIZAJE: MODELAMIENTO | SQL | (TRANSACT SQL) <-- AQUI ESTAMOS EN TRANSACT SQL

-- CREAMOS EL PROCESO PARA GENERAR 20MIL REGISTROS EN LA TABLA CLIENTES, CORRER EL SCRIPT DESDE -> "DECLARE HASTA END";
DECLARE @i INT = 1;
SELECT @i = ISNULL(MAX(id_cliente), 0) + 1 FROM CLIENTES;
WHILE @i <= 20000
BEGIN
    INSERT INTO CLIENTES (id_cliente, nombre)
    VALUES (
        @i,
        CASE 
            WHEN @i % 5 = 0 THEN 'ASUNCION'
            WHEN @i % 5 = 1 THEN 'CARLOS'
            WHEN @i % 5 = 2 THEN 'ANA'
            WHEN @i % 5 = 3 THEN 'MARIA'
            ELSE 'LUIS'
        END
    );
   SET @i += 1;
END;


-- CREACION DE INDICE 
CREATE INDEX IDX_NOMBRE_CLIENTE ON CLIENTES(NOMBRE);

-- SE VALIDA EL RENDIMIENTO DE LA CONSULTA ANTERIOR




